@import "tailwindcss";
@import "tw-animate-css";

@custom-variant dark (&:is(.dark *));

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
  --color-sidebar-ring: var(--sidebar-ring);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar: var(--sidebar);
  --color-chart-5: var(--chart-5);
  --color-chart-4: var(--chart-4);
  --color-chart-3: var(--chart-3);
  --color-chart-2: var(--chart-2);
  --color-chart-1: var(--chart-1);
  --color-ring: var(--ring);
  --color-input: var(--input);
  --color-border: var(--border);
  --color-destructive: var(--destructive);
  --color-accent-foreground: var(--accent-foreground);
  --color-accent: var(--accent);
  --color-muted-foreground: var(--muted-foreground);
  --color-muted: var(--muted);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-secondary: var(--secondary);
  --color-primary-foreground: var(--primary-foreground);
  --color-primary: var(--primary);
  --color-popover-foreground: var(--popover-foreground);
  --color-popover: var(--popover);
  --color-card-foreground: var(--card-foreground);
  --color-card: var(--card);
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
}

:root {
  --radius: 0.625rem;
  --background: oklch(1 0 0);
  --foreground: oklch(0.145 0 0);
  --card: oklch(1 0 0);
  --card-foreground: oklch(0.145 0 0);
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0.145 0 0);
  --primary: oklch(0.205 0 0);
  --primary-foreground: oklch(0.985 0 0);
  --secondary: oklch(0.97 0 0);
  --secondary-foreground: oklch(0.205 0 0);
  --muted: oklch(0.97 0 0);
  --muted-foreground: oklch(0.556 0 0);
  --accent: oklch(0.97 0 0);
  --accent-foreground: oklch(0.205 0 0);
  --destructive: oklch(0.577 0.245 27.325);
  --border: oklch(0.922 0 0);
  --input: oklch(0.922 0 0);
  --ring: oklch(0.708 0 0);
  --chart-1: oklch(0.646 0.222 41.116);
  --chart-2: oklch(0.6 0.118 184.704);
  --chart-3: oklch(0.398 0.07 227.392);
  --chart-4: oklch(0.828 0.189 84.429);
  --chart-5: oklch(0.769 0.188 70.08);
  --sidebar: oklch(0.985 0 0);
  --sidebar-foreground: oklch(0.145 0 0);
  --sidebar-primary: oklch(0.205 0 0);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.97 0 0);
  --sidebar-accent-foreground: oklch(0.205 0 0);
  --sidebar-border: oklch(0.922 0 0);
  --sidebar-ring: oklch(0.708 0 0);
}

.dark {
  --background: oklch(0 0 0);
  --foreground: oklch(0.98 0 0);
  --card: oklch(0.04 0 0);
  --card-foreground: oklch(0.98 0 0);
  --popover: oklch(0.04 0 0);
  --popover-foreground: oklch(0.98 0 0);
  --primary: oklch(0.98 0 0);
  --primary-foreground: oklch(0.09 0 0);
  --secondary: oklch(0.1 0 0);
  --secondary-foreground: oklch(0.98 0 0);
  --muted: oklch(0.15 0 0);
  --muted-foreground: oklch(0.65 0 0);
  --accent: oklch(0.15 0 0);
  --accent-foreground: oklch(0.98 0 0);
  --destructive: oklch(0.65 0.25 29);
  --border: oklch(0.27 0 0);
  --input: oklch(0.27 0 0);
  --ring: oklch(0.8 0 0);
  --chart-1: oklch(0.488 0.243 264.376);
  --chart-2: oklch(0.696 0.17 162.48);
  --chart-3: oklch(0.769 0.188 70.08);
  --chart-4: oklch(0.627 0.265 303.9);
  --chart-5: oklch(0.645 0.246 16.439);
  --sidebar: oklch(0 0 0);
  --sidebar-foreground: oklch(0.65 0 0);
  --sidebar-primary: oklch(0.98 0 0);
  --sidebar-primary-foreground: oklch(0 0 0);
  --sidebar-accent: oklch(0.1 0 0);
  --sidebar-accent-foreground: oklch(0.98 0 0);
  --sidebar-border: oklch(0.18 0 0);
  --sidebar-ring: oklch(0.8 0 0);
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }
  body {
    @apply bg-background text-foreground;
  }
  html,
  body {
    @apply overflow-hidden;
  }
}

/* This layer is by next-forge */
@layer base {
  ::after,
  ::before,
  ::backdrop,
  ::file-selector-button {
    @apply border-border;
  }
  * {
    @apply min-w-0;
  }
  html {
    text-rendering: optimizelegibility;
  }
  body {
    @apply min-h-dvh;
  }
  input::placeholder,
  textarea::placeholder {
    @apply text-muted-foreground;
  }
  button:not(:disabled),
  [role="button"]:not(:disabled) {
    @apply cursor-pointer;
  }
}

@keyframes dashdraw {
  from {
    stroke-dashoffset: 10;
  }
  to {
    stroke-dashoffset: 0;
  }
}

/* React Flow attribution styling */
.react-flow__attribution {
  background: transparent !important;
  padding: 2px 4px !important;
  font-size: 10px !important;
  opacity: 0.4 !important;
}

.dark .react-flow__attribution {
  background: transparent !important;
  color: rgba(255, 255, 255, 0.4) !important;
}

.dark .react-flow__attribution a {
  color: rgba(255, 255, 255, 0.5) !important;
}

/* React Flow pane cursor */
.react-flow__pane {
  cursor: grab !important;
}

.react-flow__pane:active {
  cursor: grabbing !important;
}

/* React Flow node and edge cursor */
.react-flow__node {
  cursor: pointer !important;
}

/* When dragging a node, show grabbing cursor */
.react-flow__node.dragging {
  cursor: grabbing !important;
}

.react-flow__edge {
  cursor: pointer !important;
}

/* React Flow handle positioning and styling */
.react-flow__handle {
  width: 12px !important;
  height: 12px !important;
  border: 2px solid var(--border) !important;
  background: var(--primary) !important;
  cursor: crosshair !important;
  z-index: 20 !important;
}

/* Increase hit area on mobile without changing visual size */
@media (max-width: 768px) {
  .react-flow__handle::after {
    content: "" !important;
    position: absolute !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
    width: 44px !important;
    height: 44px !important;
  }
}

.react-flow__handle-left {
  left: -0.5px !important;
}

.react-flow__handle-right {
  right: -0.5px !important;
}

/* Safe area support for mobile devices */
@supports (height: 100dvh) {
  html,
  body {
    height: 100dvh;
  }
}

/* Safe area support for mobile devices */
@media (max-width: 768px) {
  .workflow-controls-panel {
    bottom: calc(env(safe-area-inset-bottom, 0px) + 5.5rem) !important;
  }
}

/*
 * Pipedream Connect React styles
 * Fix z-index for react-select dropdowns in @pipedream/connect-react
 * The dropdown menu needs high z-index and the scrollable container
 * needs to allow overflow when a dropdown is open.
 */

/* Base menu styling - only colors, let react-select handle sizing/positioning */
.react-select__menu {
  background: var(--card) !important;
  border: 1px solid var(--border) !important;
  box-shadow: 0 20px 60px rgba(2, 6, 23, 0.35) !important;
  color: var(--foreground) !important;
  font-size: 0.875rem !important;
}

.pipedream-config [class$="-menu-list"],
.pipedream-config [class$="-option"],
.pipedream-config [class*="__menu-list"],
.pipedream-config [class*="__option"],
.react-select__menu-list,
.react-select__option {
  background: var(--card) !important;
  background-color: var(--card) !important;
  font-size: 0.875rem !important;
}

/* Hover effects for options */
.react-select__option:hover,
.react-select__option--is-focused {
  background: var(--accent) !important;
  background-color: var(--accent) !important;
  color: var(--foreground) !important;
}

/* Selected option - use accent background to match other form elements */
.react-select__option--is-selected {
  background: var(--accent) !important;
  background-color: var(--accent) !important;
  color: var(--foreground) !important;
  font-weight: 500 !important;
}

/* Selected + hovered */
.react-select__option--is-selected:hover,
.react-select__option--is-selected.react-select__option--is-focused {
  background: var(--accent) !important;
  color: var(--foreground) !important;
}

/* Ensure select containers have proper stacking */
.pipedream-config .react-select-container,
.pipedream-config [class*="-container"] {
  position: relative;
  width: 100%;
}

.pipedream-config [class$="-control"],
.pipedream-config [class*="__control"] {
  width: 100% !important;
}

/* When dropdown is open, boost the container z-index */
.pipedream-config [class*="-container"]:has([class$="-menu"]) {
  z-index: 100 !important;
  isolation: isolate;
}

/* Ensure menu options inherit the opaque background - but not with wildcard to preserve hover */
.react-select__menu,
.react-select__menu-list {
  background: var(--card) !important;
  background-color: var(--card) !important;
  opacity: 1 !important;
}

/* Align checkbox labels tightly in Pipedream forms */
.pipedream-config label:has(input[type="checkbox"]) {
  display: inline-flex;
  align-items: flex-start;
  gap: 0.5rem;
}
.pipedream-config label:has(input[type="checkbox"]) input[type="checkbox"] {
  margin-top: 2px;
}

/* Pipedream submit button: primary styling fallback */
.pipedream-config button[type="submit"],
.pipedream-config [class*="controlSubmit"] {
  background: hsl(var(--primary)) !important;
  color: hsl(var(--primary-foreground)) !important;
  border: 1px solid hsl(var(--primary)) !important;
  border-radius: 0.5rem !important;
  height: 2.5rem !important;
}
.pipedream-config button[type="submit"]:hover,
.pipedream-config [class*="controlSubmit"]:hover {
  background: hsl(var(--primary) / 0.9) !important;
}

/* Fix boolean field grid layout - tighten checkbox spacing */
.pipedream-config .pd-field:has(input[type="checkbox"]) {
  grid-template-columns: auto 1fr !important;
  gap: 0.25rem 0.5rem !important;
}

/* Reset all checkbox margins in pipedream forms */
.pipedream-config input[type="checkbox"] {
  width: 16px !important;
  height: 16px !important;
  margin: 0 !important;
  flex-shrink: 0 !important;
}

/* Style the menu portal - only set z-index, let react-select handle positioning */
.react-select__menu-portal {
  z-index: 99999 !important;
}

.react-select__menu-portal .react-select__menu {
  background: var(--card) !important;
  border: 1px solid var(--border) !important;
  box-shadow: 0 20px 60px rgba(2, 6, 23, 0.35) !important;
}

.react-select__menu-portal .react-select__option {
  background: var(--card) !important;
  color: var(--foreground) !important;
}

.react-select__menu-portal .react-select__option:hover,
.react-select__menu-portal .react-select__option--is-focused {
  background: var(--accent) !important;
  color: var(--foreground) !important;
}

.react-select__menu-portal .react-select__option--is-selected {
  background: var(--accent) !important;
  color: var(--foreground) !important;
  font-weight: 500 !important;
}

.react-select__menu-portal .react-select__option--is-selected:hover,
.react-select__menu-portal
  .react-select__option--is-selected.react-select__option--is-focused {
  background: var(--accent) !important;
  color: var(--foreground) !important;
}

/* Ensure the entire Pipedream config block sits above underlying content */
.pipedream-config {
  position: relative;
  z-index: 20;
}

/* When any dropdown is open, paint an overlay to hide underlying text */
.pipedream-config:has([class$="-menu"])::after {
  content: "";
  position: absolute;
  inset: 0;
  background: var(--card) !important;
  opacity: 1 !important;
  z-index: 9990;
  pointer-events: none;
}

/*
 * CRITICAL: When a dropdown is open inside the config panel,
 * temporarily remove overflow clipping from all ancestor containers.
 * This uses the :has() selector to detect when a menu is open.
 */

/* Also catch overflow-y-auto and overflow-hidden classes */
.overflow-y-auto:has([class$="-menu"]),
.overflow-auto:has([class$="-menu"]),
.overflow-hidden:has([class$="-menu"]) {
  overflow: visible !important;
}

/* Target TabsContent that might have overflow:hidden */
[data-state="active"]:has([class$="-menu"]) {
  overflow: visible !important;
}

/* Style menus for dark mode */
.dark .react-select__menu,
.dark .pipedream-config [class$="-menu"] {
  background: var(--card) !important;
  border: 1px solid var(--border) !important;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5) !important;
}

.dark .react-select__option,
.dark .pipedream-config [class$="-option"] {
  color: var(--foreground) !important;
  background: var(--card) !important;
}

.dark .react-select__option--is-focused,
.dark .pipedream-config [class$="-option"]:hover {
  background: var(--accent) !important;
}

.dark .react-select__option--is-selected {
  background: var(--primary) !important;
  color: var(--primary-foreground) !important;
}
